# Домашна работа №2

Домашна работа №2 включва работа с нишки. Състои се от 2 задачи и има максимален брой точки 400. Оценката се изчислява по следната формула:
```
оценка = 2 + (точки / 100)
```

В заданието в Google Classroom трябва да предадете архив с име `hw02-11b-NN-Name-Surname.zip`, като замените `NN` с номера си в клас и `Name` и `Surname` с двете си имена.

Шаблон на този архив можете да изтеглите от [тук](https://github.com/angel-penchev/os-tues-2023-2024/blob/main/homework/02/hw02-11b-NN-Name-Surname.zip).

Срокът на домашната работа е **до 07.01.2024 (неделя), 23:59:59**. Допълнително, отново ще трябва да ми представите домашните си работи. Съответно, за да улесните себе си и мен, **пишете четлив и качествен код**.

---

**⚠️ ВАЖНО ⚠️**

Напомням ви, че домашното ще бъде проверявано за плагиатство! При миналата домашна работа, както вече говорихме, имаше ясни случаи на хора използвали text-transformer невронни мрежи за написването решенията си. Също така, имаше хора, предали плагиатствани решения, които все пак успешно защитиха и за това домашно не съм санкционирал значително. За тези хора (знаете, кои сте) - не сте ме надхитрили, ще имам едно наум за вас при следващи домашни.

Този път, ако дори и помириша, че ChatGPT, GitHub Copilot или някоя друга подобна услуга е била използвана за генериране на код, санкциите ще са доста по-сериозни. Ако случайно сте почнали домашното и casually сте се възползвали от такива услуги, това, което искам да направите е:

- Да спрете Copilot/каквото друго ползвате
- Да изтриете целия код, който имате досега
- Да почнете начисто и да си работите самостоятелно, като всякакъв код, копиран от tutorials или examples, да бъде ясно деклариран по време на защитата

Имайте предвит, че невронните мрежи не са магия - оказва се, че са доста детерминистични в изхода си и генерират доста сходен код, който после лесно се забелява при проверката за еднаквост на домашните ви. Както с преписването, напълно възможно е да не го забележа, но рискът е на ваш гръб.

Ако ви е нужна помощ с каквото и да е - разбиране на условието, кодът и т.н., не се притеснявайте да се свържете с мен в Discord - `@justtsb` или по имейл на `angel@penchev.dev` или на `apenchev@elsys-bg.org`.

## Задача 1 - `zombies` (150 точки)
### Изисквания

```bash
apt install libncurses5-dev
```

### Условие на задачата

Целта на задачата е да се реализира проста игра с нишки.

За ваше улеснение използвайте функциите от `ui.h`.

В играта има следните участници:

#### Играч

Играчът въвежда команди от клавиатурата. Те се четат с помощта на функцията `get_input``, която връща един прочетен символ.

Командите са следните:

* m - построява миньор, който събира злато - Цена 100 злато
* s - построява войник - Цена 10 злато
* x - построява 10 войника - Цена 100 злато

При успешно построяване се извежда съответно съобщение чрез `print_msg`:

* "Miner created!"
* "Soldier created!"
* "10 x soldiers created!"

При недостатъчно злато се извежда: "Not enough gold!" чрез функцията `print_fail`.

#### Миньор

Изпълнява се всеки в отделна нишка и прави следните действия:

* Добавя 10 злато към златото на играча
* Спи 1 секунда

Това се изплънява в безкраен цикъл.

#### Зомбита

Зомбитата нападат играча. Те се изпълняват в отделна нишка, но тя е една за всички зомбита
Дейстията, които извършва тази нишка, са:

<!---
* **Допълнение: Изчакват, ако играчът има по-малко от 100 злато. В момента, в който играчът има поне 100 злато, започват да се приближават и не могат да бъдат спрени.**
--->
* Започвайки от разстояние 5, се доближават до играча на всяка секунда
* Когато стигнат до играча, го нападат. Ако той има по-малко войници, отколкото зомбита в текущата вълна, то му се намалява точките живот с разликата между броя войници и броя зомбита
* Ако войниците са повече, то не се случва нищо
* Броят на зомбитата се умножава по 2. Първоначалният брой е 1.

При успешна атака се извежда "Zombie attack succeded ;(!" чрез функцията `print_fail`.

При неуспешна атака се извежда "Zombie attack deflected! :)" чрез функцията `print_succ`.


##### Псевдокод

```python
for i = 0 to i = 5
    print_zombies(i, брой зомбита)
    изчаква 1 секунда

if брой зомбита > брой войници:
    успешна атака, намаля се живота на играча с (брой зомбита - брой войници)
    извежда се print_fail("Zombie attack succeded ;(!")
    обновява се живота на играча и ако е 0 или по-малко, играта приключва чрез game_end
else
    неуспешна атака, извежда се print_succ("Zombie attack deflected! :)")

увеличават се зомбитата 2 пъти и се започва отначалото

```

#### Изисквания относно съобщенията

* При всяка промяна на златото (от миньор или при покупка), то следва да се извика функцията print_gold
* При всяка промяна на броя войници, то следва да се извика функцията print_soldiers
* При всяка промяна на жизнените точки, то следва да се извика функцията print_health
* При всяка промяна на броя зомбита или разстоянието до играча, трябва да се извика функцията print_zombies

#### Край на играта

* Когато играчът стане на 0 или по-малко жизнени точки, играта приключва
* Това става чрез функцията game_end
* За опростояване на задачата, няма нужда да се грижите на правилното приключване на нишките. В бъдещи задачи това ще е задължително.

## Задача 2 - `starcraft` (250 точки)

Студиото за разработка на игри Blizzard Entertainment има нужда от помощ в разработването на прототип на следваща игра от поредицата StarCraft. Подобно на предишните версии на играта, когато играта стартира, играчът разполага с 5 работници (SCV), Команден център (Command Center) и 0 минерали. Целта на играча е да построи 20 войника. Войниците струват минерали, които се набавят с помощта на работници. Броят на минералните блокове се подава като аргумент при стартирането на играта. Играта приключва след като се изкопаят всички минерални блокове на картата и се построят 20 войника. Играчът подава команди на стандартния вход. Целта на задачата е да се реализира синхронизация на нишки посредством `mutex`-и.

### Работници

Работниците служат за добиване на минерали. Изпълняват следната поредица
от действия:

1.  Придвижване до непразен минерален блок (симулира се време, 3s).

2.  Проверка дали минералния блок е свободен (не се симулира
    допълнително време)

3.  Копаене на минерали (не се симулира допълнително време).

4.  Транспортиране на минералите до Командния център (симулира се време,
    2s).

5.  Разтоварване на минералите (не се симулира допълнително време).

6.  (Връщане на стъпка 1).

При всяко копаене се добиват 8 минерала. Всеки работник трябва да се
изпълнява в отделна нишка. При изчерпване на минералите на картата
нишките на работниците трябва да прекратят изпълнението си.

### Команден център

Командният център служи за обучение на войници и като място за
разтоварване на минерали. Обучението на войници не пречи на
разтоварването на минерали. Изисквания:

-   В Командния център трябва да може да се разтоварват минерали и да се
    обучават войници едновременно.

-   Само по един работник може да разтоварва минерали в Командния център
    по едно и също време.

Обучаването на войник струва 50 минерала и се симулира време за обучение
1s. След обучението на войник трябва да се изведе съобщението "You wanna
piece of me, boy?".

### Команди подавани от играча

Командите се подават от играча на стандартния вход. Възможните команди
са:

-   "m" за да се построи нов войник.

### Общи

-   Първоначалният брой минерални блокове е 2 (ако не е подаден аргумент
    на програмата).

-   Всеки минерален блок съдържа 500 минерала.

-   Общият брой работници и войници не може да надвишава 200.

-   Всички нишки трябва да работят паралелно една спрямо друга.

-   Синхронизацията между отделните нишки трябва да става посредством
    `mutex`-и.

-   Симулирането на време става чрез използването на `sleep()`.

-   Не е нужно да се следи за ситуации, в които играчът не може да
    завърши успешно играта.

При приключване на играта трябва да се изведе броя на първоначалните
минерали на картата, текущото количество минерали на играча, броя на
работници и броя на войници (Пример: "Map minerals N, player minerals M,
SCVs X, Marines Y", където N, M, X, Y са броя на съответните ресурси).
При правилно решение на задачата, сумата на текущото количество минерали
и похарчените за единици ВИНАГИ ще е равна на първоначалните минерали на
картата.

### Примерна игра
```
SCV 1 is mining from mineral block 1
SCV 1 is transporting minerals
SCV 1 delivered minerals to the Command Center
SCV 2 is mining from mineral block 2
SCV 2 is transporting minerals
SCV 2 delivered minerals to the Command Center
SCV 3 is mining from mineral block 1
SCV 3 is transporting minerals
SCV 3 delivered minerals to the Command Center
SCV 4 is mining from mineral block 2
SCV 4 is transporting minerals
SCV 4 delivered minerals to the Command Center
m
Not enough minerals.
SCV 5 is mining from mineral block 2
SCV 5 is transporting minerals
SCV 5 delivered minerals to the Command Center
SCV 1 is mining from mineral block 1
SCV 1 is transporting minerals
SCV 1 delivered minerals to the Command Center
SCV 2 is mining from mineral block 2
SCV 2 is transporting minerals
SCV 2 delivered minerals to the Command Center
m
You wanna piece of me, boy?
...
Map minerals 1000, player minerals 0, SCVs 5, Marines 20
```

## Поддръжка на N на брой работници

Играчът има възможност да обучава работници от Командния център, чрез въвеждане на команда "s" на стандартния вход. Цената на един работник е 50 минерала и времето за обучение е 4s. След обучението на работник
трябва да се извежда съобщението "SCV good to go, sir.".
```
...
SCV 1 is mining from mineral block 1
SCV 1 is transporting minerals 
SCV 1 delivered minerals to the Command Centers
SCV 1 is mining from mineral block 2
SCV 1 is transporting minerals
SCV good to go, sir.
SCV 2 is mining from mineral block 3
SCV 2 is transporting minerals
SCV 1 delivered minerals to the Command Center
SCV 2 delivered minerals to the Command Center
...
```

## Обработка на грешки

-   При логически грешки от страна на играча трябва да се изведе съобщение за грешка и играта да се продължи. Пример за логическа
    грешка е строенето на войник, когато няма достатъчно събрани
    минерали.

-   Ако при извикване на pthread_create, pthread_mutex_init, и т.н. възникне грешка, трябва да се изведе съобщение за грешка и
    програмата да се прекрати.